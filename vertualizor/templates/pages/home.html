{% extends '../base/base.html' %}
{% block content %}
<div>
      <div>
            <form id='post-create-form' method='POST' action='/create/'>
                  {% csrf_token %}
                  <textarea  name='content'></textarea>
                  <button type='submit'>Save</button>
            
                </form>
                
      </div>
          <div class="container" id='posts'>
            loading ...
      </div>
</div>

<script>
      function postFormatting(item,index){
            return '<div style="display:flex">'+index+"<p> . "+item.content+"</p>" + "<button>" +item.likes+' like'+"</button>"+'</div>'
      }
      function loadPosts(element){
      const xhr = new XMLHttpRequest()
xhr.responseType = 'json'
xhr.open("GET","/posts/")

xhr.onload = function(){
      var posts = ''
      var like = 0
      var dislike = 0

// console.log(like, dislike)
      var listItems = xhr.response.response
      listItems.map((item,index)=>{
            posts = posts+postFormatting(item,index)
      })
      element.innerHTML = posts
      function hanldeLike(){
      like =like+1
}
function hanldeDisLike(){
      dislike = dislike+1
}

}

xhr.send()
}




const postForm = document.getElementById('post-create-form')
function handleSubmit(event){
      event.preventDefault()
const action = event.target.getAttribute('action')
const method = event.target.getAttribute('method')
xhr = new XMLHttpRequest()
xhr.onload =()=>{
      const serverResponse = xhr.response
      loadPosts(document.getElementById('posts'))
      console.log(xhr.status, serverResponse)
      //this will help us re-render the new tweets
}
xhr.open(method,action)
// setRequestHeader manually if you want is_ajax() to work.
xhr.setRequestHeader('HTTP_X_REQUESTED_WITH','XMLHttpRequest')
xhr.setRequestHeader('X-Requested-with','XMLHttpRequest')
const myFormData = new FormData(event.target)
xhr.send(myFormData)

}
postForm.addEventListener("submit", handleSubmit )

const element = document.getElementById('posts')
loadPosts(element)

</script>
{% endblock content %}